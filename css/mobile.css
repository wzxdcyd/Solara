/* =========================================
   Solara Mobile UI - Desktop-Style Port
   ========================================= */

@media screen and (max-width: 820px) {

    /* --- 1. Restore Background --- */
    /* Force display of the background stage which index.js updates */
    .background-stage {
        display: block !important;
        position: fixed;
        inset: 0;
        z-index: -1;
    }
    
    .background-stage__layer {
        position: absolute;
        inset: 0;
        background-size: cover;
        background-position: center;
        filter: blur(30px) brightness(0.6); /* Add blur for readability */
    }

    /* Reset body background to transparent so stage shows through */
    body {
        background: transparent !important;
        display: flex;
        flex-direction: column;
        height: 100vh;
        overflow: hidden;
    }

    /* --- 2. Hide Mobile-Specific Custom Elements --- */
    .mobile-toolbar,
    .mobile-panel,
    #mobileBackground,
    .mobile-overlay-scrim,
    .mobile-close-btn {
        display: none !important;
    }

    /* --- 3. Main Container Layout (Vertical Stack) --- */
    .container {
        display: flex !important;
        flex-direction: column;
        width: 100% !important;
        height: 100% !important;
        max-width: none !important;
        max-height: none !important;
        margin: 0 !important;
        padding: 10px !important;
        padding-top: env(safe-area-inset-top) !important;
        padding-bottom: 0 !important;
        background: transparent !important;
        border: none !important;
        box-shadow: none !important;
        gap: 12px;
        overflow: hidden; /* Manage scroll internally */
        position: relative;
    }

    .container::after { display: none !important; }

    /* --- 4. Component Cards (Glassy Look) --- */
    .header,
    .search-area,
    .cover-area,
    .playlist,
    .controls {
        background: rgba(255, 255, 255, 0.15) !important;
        backdrop-filter: blur(20px) saturate(180%);
        -webkit-backdrop-filter: blur(20px) saturate(180%);
        border: 1px solid rgba(255, 255, 255, 0.15) !important;
        border-radius: 16px !important;
        padding: 15px !important;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1) !important;
        width: 100% !important;
        box-sizing: border-box !important;
        margin: 0 !important;
    }

    /* Dark Mode Overrides for Cards */
    body.dark-mode .header,
    body.dark-mode .search-area,
    body.dark-mode .cover-area,
    body.dark-mode .playlist,
    body.dark-mode .controls {
        background: rgba(30, 30, 30, 0.6) !important;
        border-color: rgba(255, 255, 255, 0.1) !important;
    }

    /* --- 5. Specific Component Tweaks --- */

    /* Header */
    .header {
        flex: 0 0 auto;
        display: flex !important;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px !important;
    }
    .header h1 { font-size: 1.2rem; margin: 0; }
    .theme-switch-wrapper { display: flex !important; position: static; }

    /* Search (Hidden by default or smaller?) */
    /* Let's make search collapsible or just small */
    .search-area {
        flex: 0 0 auto;
        z-index: 50;
    }
    .search-container { margin-bottom: 0 !important; }
    .search-results {
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        max-height: 50vh;
        background: rgba(20, 20, 20, 0.95);
        z-index: 100;
        border-radius: 12px;
        overflow-y: auto;
    }

    /* Main Scrollable Area */
    .mobile-scroll-content {
        flex: 1;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 12px;
        min-height: 0;
        padding-bottom: 80px; /* Space for controls */
    }

    /* Cover Area */
    .cover-area {
        flex: 0 0 auto;
        display: flex;
        flex-direction: row; /* Horizontal layout for cover + info? No, vertical is better for mobile */
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    .album-cover {
        width: 180px !important;
        height: 180px !important;
        margin-bottom: 10px;
    }

    /* Playlist */
    .playlist {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 300px; /* Ensure visibility */
    }
    .playlist-scroll {
        flex: 1;
        overflow-y: auto;
    }

    /* Lyrics (Hide by default on mobile to save space, or show under playlist) */
    .lyrics {
        display: none !important; 
    }

    /* Controls (Sticky Bottom) */
    .controls {
        position: fixed;
        bottom: 10px;
        left: 10px;
        right: 10px;
        width: calc(100% - 20px) !important;
        z-index: 100;
        display: flex !important;
        flex-direction: column;
        gap: 10px;
        background: rgba(20, 20, 20, 0.85) !important;
        backdrop-filter: blur(25px) !important;
        -webkit-backdrop-filter: blur(25px) !important;
        border: 1px solid rgba(255, 255, 255, 0.1) !important;
    }

    /* Controls Layout */
    .transport-controls {
        justify-content: center;
        gap: 20px;
    }
    .transport-button {
        width: 40px; height: 40px; font-size: 18px;
    }
    .transport-button--play {
        width: 50px; height: 50px; font-size: 22px;
    }
    
    .progress-container {
        width: 100%;
    }
    
    .control-trailing {
        display: none !important; /* Hide volume etc on mobile to save space */
    }

    /* --- 6. Flex Order --- */
    /* We can use order property to rearrange grid items into flex column */
    .header { order: 1; }
    .search-area { order: 2; }
    .cover-area { order: 3; }
    .playlist { order: 4; }
    /* Controls are fixed, order doesn't matter much but logical 5 */
}
